<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- <mapper namespace="user">
	<select id="user" resultType="com.walab.coding.Model.UserDTO" parameterType="hashmap">
		SELECT name,email,userNumber,nickName,intro FROM user WHERE userID=#{userID}
	</select>

</mapper> -->

<mapper namespace="goal">
	<select id="readGoal" resultType="com.walab.coding.model.GoalDTO" parameterType="hashmap">
		SELECT * FROM goal WHERE userID=#{userID} ORDER BY DATE(startDate) DESC limit 1	
	</select>
	 
	<select id="readGoalList" resultType="com.walab.coding.model.GoalDTO" parameterType="hashmap">
		SELECT (count(if(<![CDATA[A.regdate >= B.startdate and A.regdate <= B.enddate]]>, A.userID, null))/B.goalNum)*100 as rate, 
		B.id, B.goalNum, B.goal, B.startdate as startDate, B.enddate as endDate
		FROM YeeunJ.userProblem as A, 
		(SELECT * FROM YeeunJ.goal WHERE userID=#{userID}) as B 
		WHERE A.userID=#{userID}
		GROUP BY B.startdate, B.enddate
		ORDER BY DATE(startdate) desc;
	</select>
	
	<update id="updateGoal" parameterType="hashmap">
		UPDATE goal SET goal='${goal}', startDate='${startDate}', endDate='${endDate}', goalNum='${goalNum}' WHERE id = #{id}
	</update>
</mapper>
